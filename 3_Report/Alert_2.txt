어제 경고를 위한 검색을 미리 살펴보았다. 다시 한 번 말하지만 경고는 관리자의 후속조치를 이끌어 내기 위해서 발령하는 것이다. 

index=book sourcetype="access_combined_wcookie" status=500 
| stats count(clientip) as cIP values(uri) as lUri by clientip 
| sort - cIP

이제 검색 결과를 기본으로 경고를 작성해보자. 
시간범위를 선택 창 위의 다른 이름으로 저장을 클릭하고 경고를 선택한다. 


제목: 경고의 제목을 적는다. 직관적이고 이해하기 쉽게 제목을 설정한다.
권한: 해당 경고를 본인만 사용할지 다른 사용자도 사용하게 할지를 설정한다.
경고유형: 예약됨으로 설정해서 주기적으로 처리하도록 한다. 여기서는 예제를 위해서 매시간으로 설정했다. 
        실행방법은 매시간, 매일, 매주, 매달로 지정할 수 있으며 더 상세한 설정은 크론 스케줄로 할 수 있다.
트리거 조건: 경고의 핵심 항목이다. 경고를 일으키는 조건이다. 결과 수, 호스트의 수, 원본의 수 등으로 지정할 수 있다. 
          조건 역시 여러가지를 설정할 수 있다. 보다 큼, 보다 작음, 같음, 같지 않으, 하강, 상승을 선택할 수 있다. 
트리거 작업: 트리거가 충족되면 이후 액션을 정할 수 있다. 여기에서는 이메일 보내기를 해보자. 작업 추가 내역은 보고서와 매우 유사하다.
          받는 사람에 메일 주소를 적는다. 여러 명을 수신자로 설정하려면 쉼표(,)로 구분해서 넣는다. CC와 BCC를 지정할 수 있다.
포함: 메일에 포함될 내역을 설정하는 것이다. PDF첨부는 검색결과를 PDF 파일로 만들어서 첨부한다. 원본을 직접 사용하려면 CSV첨부를 사용할 수도 있다.

모든 설정을 마치면 저장한다. 

보고서 항목(보고서 링크 연결하기)에서 보내는 메일 서버 설정을 살펴보았다. 한가지 더 추가할 내용이 있다. 
보내는 메일 서버 설정에 이메일 형식을 더 설정해야 메일이 정상적으로 전송된다. 이메일 발신자 이름은 메일을 보내는 계정을 적는다.
메일 서버 설정에서 사용자 이름과 동일하게 적으면 보고서, 경고 메일이 모두 정상적으로 발송된다. 

아래 그림은 경고로 수신한 메일의 본문이다. 
경고에서 설정한 내용과 메일의 본문이 일치하는 것을 볼 수 있다. 

이렇듯 경고는 관리자가 다른 업무를 수행하고 있더라고 문제가 있음을 알려주는 역할을 수행한다. 이제 관리자는 무조건 Splunk화면을 뚫어지게 쳐다볼 필요가 없다. 

보고서와 경고가 동일한 방식으로 동작한다고 말하는 사람들도 있다. 사실 맞는 말이다. 다만 두 개의 차이점은 트리거라는 항목이다. 
보고서는 정해진 시간에 검색결과를 생성하는 것이다. 하지만 경고는 정해진 시간에 검색결과를 생성하는 것까지는 동일하지만 트리거 조건에 맞지 않으면 더 이상 동작하지 않는다.

향후에 보안 관련 로그를 이용해서 대시보드를 구축하고 경고를 설정하면 관리자는 훌륭한 SIEM을 얻게 될 것이다.
