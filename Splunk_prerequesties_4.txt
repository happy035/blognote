오늘은 Splunk에서 데이터를 적재하는 법을 살펴보자. 

Splunk에 데이터를 적재하는 로컬입력과 전달된 입력을 나뉜다. 로컬 입력은 Splunk 프로그램이 설치된 로컬 디스크를 직접 인덱싱하는 방법이다.
전달된 입력은 외부에서 Splunk 서버로 로그를 전달하는 것을 수신하여 데이터를 입력하는 방식이다. 데이터 입력에서 아래의 내역을 살펴본다.

1. 로컬입력 -> 파일 및 디렉토리 -> 디렉토리 설정
2. 로컬입력 -> 파일 및 디렉토리 -> 파일 업로드


<< 디렉토리 설정 >>
디렉토리 설정은 Splunk가 설치된 서버의 로컬 디스크의 파일 및 디렉토리를 모니터링하는 방법이다. 
데이터 입력으로 디렉토리를 설정하면 Splunk는 하위 디렉토리의 모든 변화를 감지하여 데이터를 적재하고 인덱싱을 수행한다.
다음 순서로 파일 및 디렉토리 데이터 입력을 설정한다. 

1. 설정->데이터->데이터 입력을 선택한다.
2. 로컬 입력 -> 파일 및 디렉토리를 선택한다. 
3. 우측 상단의 새 로컬 파일 및 디렉토리를 선택한다.
4. 화면의 안내를 따라 진행한다. 
  4.1 파일 또는 디렉토리의 찾아보기 버튼을 클릭한다.
  4.2 지속적으로 모니터링은 이 선택한 항목을 계속 Splunk로 적재한다는 의미이다. 
  4.3 한 번만 인덱싱은 1회만 데이터를 적재한다는 뜻이므로, 한 번만 분석할 때 사용한다. 
  4.4 디렉토리 목록 또는 파일을 선택한다. 이 목록에 나오는 디렉토리는 Splunk가 실행되는 서버의 디렉토리 구조이다. 
      Splunk 서버에 접속하는 사용자 컴퓨터 디렉토리 구조가 아니다. 
  4.5 디렉토리를 정하고 다음으로 이동하면 입력 데이터 설정 부분이 나타난다. 
  4.6 현재 입력하는 데이터에 대한 sourcetype을 지정한다. 
  4.7 앱 컨텍스트는 어떤 앱에서 이 데이터를 사용할 것인지를 알려준다. Search & Reporting을 선택한다.
  4.8 host값은 데이터를 생성한 컴퓨터 이름을 지정한다. 이 데이터가 어떤 호스트에서 왔는지를 지정할 수 있다.
  4.9 인덱스는 데이터를 저장하는 하나의 저장소이다. 인덱스마다 별도의 저장소가 생성된다. 그러므로 같은 유형의 데이터는 하나의 인덱스에 수집하는 것이 바람직하다. 
      앞으로 실습을 계속하기 위해서 새 인덱스를 만들어보자.
  4.10 새 인덱스 만들기를 클릭한다. 나오는 창에 다음과 같이 입력한다.
  4.11 인덱스 이름을 입력하고 전체 인덱스의 크기를 수정하고 저장버튼을 클릭한다.. 실습에 사용할 인덱스를 크게 잡을 필요는 없다.
  4.12 상단의 검토 버튼을 눌러서 다음 단계로 넘어간다.
  4.13 입력한 내용을 최종 검토하는 단계다. 수정할 사항이 없다면 제출버튼을 클릭한다. 

<< 파일 업로드 >>
파일 업로드는 대부분 1회성 분석용 데이터를 Splunk에 적재할 때 사용한다. 데이터를 업로드는 할 때 주의할 사항이 있다. 
먼저 최대 500MB 파일까지만 업로드할 수 있다. 그리고 이렇게 업로드 하는 파일의 용량도 Splunk 라이센스에서 지정한 일일 인덱싱 용량을 사용한다.
먼저 업로드할 파일을 다운로드 하자. 앞으로도 검색 실습에 이 데이터를 계속 사용한다. 사용할 예제 데이터는 Splunk에서 제공하는 tutorial 데이터이다. 

1. 다음 두 파일을 본인의 컴퓨터에 다운로드 받는다. 
  1.1 http://docs.splunk.com/images/Tutorial/tutorialdata.zip
  1.2 http://docs.splunk.com/images/d/db/Prices.csv.zip 
2. 설정->데이터->데이터 입력을 선택한다.
3. 로컬 입력 -> 파일 및 디렉토리를 선택한다. 
4. 상단 메뉴에서 데이터 추가를 클릭한다. 
5. 데이터 추가 -> 업로드를 선택한다. 
6. 원본 선택 화면이 나오면 파일 선택버튼을 눌러서 파일을 선택하거나 탐색기에서 파일을 마우스로 끌어서 놓아도 된다.
   디렉토리 모니터링은 Splunk 서버의 디렉토리 구조가 나오지만 업로드는 사용자 컴퓨터의 로컬 디스크가 보여진다.
   로그가 zip형식으로 압축되어 있다면 압축을 해제하지 않고 바로 업로드할 수 있다. tutorial 데이터는 여러 개의 디렉토리 구조로 되어 있다. 
   압축을 해제하고 www1의 access.log 파일을 업로드 한다.
7. Splunk는 로그 형식을 자동으로 인식해서 sourcetype을 지정한다. 다음 버튼을 클릭한다.
8. 소스타입은 자동으로 지정되었다. 이제 host와 인덱스를 설정한다. www1의 로그를 업로드 했으므로 host는 www1으로 지정한다. 인덱스는 앞서 생성한 book을 사용한다.
9. 검토 후 제출을 클릭하면 파일이 성공적으로 업로드 된다. 검색 시작버튼을 누르면 바로 데이터를 검색할 수 있다.
10. 이와 같은 방식으로 www1의 나머지 로그와 www2, www3의 로그도 모두 업로드한다. secure.log 파일의 sourcetype은 linux_secure를 선택한다.
    www2와 www3 디렉토리의 데이터를 업로드할 때 호스트를 각각 www2와 www3로 입력하자. 향후에 호스트를 기반으로 검색할 때 유용하다.

이제까지 두 가지 방식의 데이터 입력 방식을 살펴보았다. 사실 살펴본 두 방식은 데이터를 수집해서 분석하는 방식과는 맞지 않는다. 
Splunk 서버가 구동중인 서버에서 데이터를 수집하는 경우는 드물기 때문이다. 즉, 웹 서버에 Splunk 서버를 동시에 구동시키지는 않는다는 말이다.
실제 운영하는 Splunk 서버는 전달된 입력을 많이 사용한다. 하지만 이것은 Splunk 관리자(Admin)이 설정한다. 검색을 주로 하는 사용자(user)는 이 메뉴를 크게 신경쓰지 않아도 된다.