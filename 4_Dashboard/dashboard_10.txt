지금까지 다양한 대시보드를 만들어보았다. 오늘은 대시보드를 더 효과적으로 사용하는 방법을 알아보자.
대시보드는 사용자나 관리자가 보유한 데이터를 목적에 맞게 시각화함으로써 직관적인 정보를 전달하는데 큰 효과를 보여준다.
그렇기 때문에 대시보드는 대부분이 요약정보라고 볼 수 있다. 즉, 각 지표에서 특징 값을 추출하여 대표값을 제시하고 있는 것이다. 

그렇지만 상황에 따라서 요약정보를 상세하게 보고 싶을 때도 있다. 간단한 예를 들어보자. 
사용자가 구매 행위별 거래현황과 프로그램 오류를 보여주는 대시보드가 아래와 같이 있다.

당연한 얘기지만 이런 오류는 서비스를 운영하는 곳에서는 발생하지 않기를 바라는 심각한 오류이다. 
이런 그래프를 보면 오류가 증가하는지 감소하는지에 대한 동향을 파악할 수 있다. 어떤 클라이언트에서 해당 오류가 발생했는지는 알 수가 없다. 
Splunk는 이를 위해서 Drill down이라는 기법을 제공한다. Splunk 한글판에서도 이 단어는 번역이 되어 있지 않아서 그냥 drill down이라고 사용한다.
검색 조건이 많을 수록 반환되는 검색 결과는 작아진다. 결국 drill down은 원하는 결과값을 얻기 위해서 필요한 조건을 추가하여 검색하는 것이다.
대시보드에서 drill down 개념도 유사하자. 대시보드가 보여주는 값을 선택하면 값에 맞는 상세 목록을 보여주기 때문이다. 
대부분의 대시보드가 시각화 패널로 구성된 것을 감안하면 IP 목록, 상태코드 목록 등 테이블형식의 상세 데이터의 점검도 필요하다.

그럼 대시보드에 drill down을 설정하는 방법을 알아보자. 먼저 테이블 형식의 데이터에서 drill down을 설정해보자. 
drill down은 검색 결과에서 한 단계 더 깊은 검색을 실행한다. 그러므로 검색 결과를 먼저 얻어야 한다. 
연습을 위해서 대시보드를 하나 새로이 만들어보자. Splunk 메뉴에서 대시보드 -> 새 대시보드 만들기를 선택한다. 다음과 같이 입력하고 대시보드 만들기를 클릭한다.
아무것도 없는 대시보드가 편집상태로 열려있을 것이다. 다음과 같이 패널을 추가한다. 

1. 패널 추가 -> 새로만들기 -> Statistics Table를 선택한다.
2. 시간 선택기를 사용해서 전체시간으로 설정한다. 
3. 콘텐츠 제목에 500 계열 오류 현황이라고 입력한다.
4. 검색 문자열에 아래와 같이 입력한다. 
index=book sourcetype="access_combined_wcookie" status="5*"
| stats count(action) by status | rename status AS "상태코드"
5. 대시보드에 추가 버튼을 클릭한다.

<10_2 배치>
이제 500, 5032, 505의 상태 코드 목록을 얻을 수 있다. 그런데 이 상황에서는 500 코드는 326개, 502은 563개등 검색기간의 개수만을 알 수 있다. 
어떤 정보를 사용자에게 추가로 제공하면 좋을 것인가를 고민해야 한다. 그럼 이제 drill down을 설정해보자.
drill down 설정은 패널이 편집모드일때만 동작하며 상세 설정을 위해서는 가장 오른쪽에 있는 점 세개 아이콘(추가작업)을 클릭하면 된다. 

<10_3 배치>

추가작업 아이콘을 클릭하고 "Edit Drilldown"을 클릭하면 드릴다운 편집기를 볼 수 있다. 
Splunk는 다음과 같이 아주 많은 드릴다운 연결 방법을 제공하고 있다. 각각의 항목을 간단히 살펴보자. 

** 검색에 연결 **
이 항목은 사용자가 검색결과를 클릭했을 때 새로운 검색을 실행시키는 방식이다. 자동과 사용자 지정 방식으로 나눌 수 있다. 
자동은 현재 검색결과에 사용자가 클릭한 값을 자동으로 추가해서 검색하는 방식이다. 이 검색은 현재 대시보드 창에 새로운 검색을 실행시킨다.
현재 검색결과를 생성한 검색어는 다음과 같다. 

index=book sourcetype="access_combined_wcookie" status="5*"  status=503

자동인 경우 사용자가 선택한 값이 503이라면 status="503"이 추가되면서 다음의 검색어가 실행된다. 
원본 검색어가 stats 명령어를 사용해서 통계를 반환한 것과 달리 자동은 원본 이벤트를 반환한다. 

사용자 지정은 사용자가 원하는 검색결과를 얻을 수 있게 사용자 지정 검색어를 설정할 수 있다. 검색 문자열에 원하는 검색어를 작성한다.
대부분의 사용자는 대시보드의 값을 클릭했을 때 선택한 값에 맞는 상세 데이터를 보기 원할 것이다. 그렇다면 마우스로 클릭한 셀의 값을 얻어와야 한다.
Splunk는 대시보드에서 마우스 클릭 이벤트를 처리하기 위해 $click.value$라는 특수 변수를 제공한다.
이 대시보드에서 사용자들이 클릭은 상태 코드 필드의 값을 선택하는 행위이므로 필드에 값을 할당해서 검색을 수행한다. 다음의 검색어를 활용할 수 있다.

index=book sourcetype="access_combined_wcookie" status="$click.value$" 
| top showperc=f useother=t limit=9 clientip

status="$click.value$", 이 구문이 사용자들이 선택하는 값을 검색어에 인자로 넘겨준다. 
top 명령어에서 그동안 사용하지 않은 옵션이 하나 보인다. limit=9이므로 상위 9개의 clientip 목록을 우선 보여준다. 
이후 10위부터 나머지까지는 useother 필드인 10번째 순위로 모두 묶이게 된다. 
마지막 옵션에서 새 탭에서 열기는 drill down결과를 브라우저의 새로운 탭에서 보여준다는 의미이다. 

** 대시보드에 연결 // 리포트에 연결 **
지정한 대시보드와 리포트로 연결한다. 이 연결에는 특별한 옵션을 필요하지 않는다.

** 사용자 지정 URL에 연결 **
말그대로 사용자 지정 URL에 링크를 생성한다. 이 drill down은 내부의 도움말 페이지, 특정 코드에 대한 설명 페이지로 연결할 때 주로 사용한다.

외부의 절대 주소를 사용하거나 내부의 Splunk 앱(App)의 상대주소를 사용할 수 있다. 하지만 내부의 데이터를 외부에 조회하는 것은 보안상 그리 좋은 것이 아니다. 
그러므로 외부로의 직접 연결은 확실한 웹 사이트 외에는 많은 사용을 자제하는 것이 좋다.
CVE ID를 안다면 다음의 주소를 사용해서 직접 연결할 수 있다.

https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=$click.value$

마지막 선택사항은 이 대시보드에 있는 토큰 관리이다. 이 항목은 대시보드에서 발생하는 대부분의 이벤트를 처리할 수 있는 매우 강력한 옵션이다.
이 내용은 내일 자세히 살펴보기로 한다.