FTP(File Transfer Protocol)는 인터넷에서 클라이언트와 서버간의 파일을 전송할때 사용하는 프로토콜이다. 
가볍고 속도가 빨라 여전히 많이들 사용하고 있지만 FTP 서버보다는 웹서버에서 파일을 전송하는 쪽으로 변해가는 추세이다.

FTP는 클라이언트에서 서버로 접속해서 파일을 업로드하거나 다운로드하는 방식을 취한다. 
로그에서 주로 살펴볼 곳은 인증 부분, 파일 전송 명령어를 확인하고, 파일 크기 등이 보안사고 분석에 사용될 수 있다.

ts, uid, id 관련 필드는 다른 로그와 동일하므로 FTP 특화된 필드만을 살펴보자. 

1535454939.566052	// ts, 시간정보
CLZU403Mc0GHwMTivc	// uid
172.16.100.100	    // id.orig_h, 출발지 IP
49076	            // id.orig_p, 출발지 포트
192.168.100.100     // id.resp_h, 목적지 IP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
21	                // id.resp_p, 목적지 포트
opsadmin            // user, 사용자 계정
<hidden>            // password, 사용자 비밀번호	
PORT	            // command, 명령어
172,16,100,100,142,76	// arg, 명령어 인자
200                 // reply_code, 서버 응답 코드	
PORT command successful.	// reply_msg, 서버 응답 메시지
F	               // data_channel_passive, FTP의 패시브 모드
192.168.100.100	    // data_channel_orig_h, 데이터 채널의 출발지 IP
172.16.100.100     // data_channel_resp_h, 데이터 채널의 목적지 IP
36428	            // data_channel_resp_p, 데이터 채널의 목적지 포트
FD5BLM3nJbTrYcOUF6  // fuid, 전송한 파일의 id

앞서 언급했듯이 bro는 어플리케이션 프로토콜의 헤더에서 대부분의 정보를 추출한다. 그렇기 때문에 프로토콜을 잘 이해하고 있으면 로그 분석이 대단히 용이하다. 
위의 로그에서 특별히 어려운 내용은 없지만 데이 전송 포트에 대해서만 알아보자.

FTP는 명령어 채널과 데이터 채널 두 개로 구성된다. 우리가 알고 있는 FTP의 21/TCP는 명령어 채널이다. 
이후 실제 데이터를 주고 받을 때 데이터 채널을 열게 되는데 이 방식이 Active인지와 Passive인지에 따라서 방식이 다르다.
위에서 data_channel_passive 필드가 F로 설정되어 있다. 이것은 FTP에서 Active 모드로 통신한다는 의미이다. 
Active 모드로 설정하면 클라이언트가 데이터를 받는 포트를 개방하고 서버에게 이 포트 번호를 알려준다. 
이후 서버가 클라이언트에게 접속하여 데이터를 전송한다. 그러므로 로그를 보면 id.orig_h인 172.16.100.100이 data_channel_resp.h로 나타나있다. 
이것은 접속한 클라이언트가 172.16.100.100이지만 데이터를 받을 때는 서버쪽에서 접속하므로 클라이언트가 목적지가 되었다는 의미이다. 
PORT 명령어를 통해서 서버에게 알려주며 이는 명령어의 인자인 arg 필드에 나타나있다. 172,16,100,100,142,76 앞의 네 자리는 클라이언트의 IP 주소이다. 뒤의 두 숫자가 포트 번호를 계산하는 데 필요한 인자이다.  포트번호는 (142*256)+76으로 계산한다.  즉, 인자의 다섯 번째 숫자에 256을 곱하고 6번째 숫자를 더하는 것이다. 위 식을 계산하면 36428이 나오고 이는 data_channel_resp_p값과 같다. 
bro는 데이터 채널의 목적지 포트를 계산해서 알려주고 있는 것이다.

FTP는 예전에 비해서 사용성이 많이 줄었지만 그래도 많이 사용하는 프로토콜이다. FTP 서비스를 제공하지 않는다면 관련 포트는 모두 차단하는 것이 좋다.